<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Jogo War</title>
  <link href="{{ url_for('static', filename='index-styles.css') }}" rel="stylesheet" />
</head>
<body>
  <h1>Jogo War</h1>
  <h3>Versão RJ</h3>
  <button id="openDialog">Jogar</button>

  <audio id="audio" loop>
    <source src="{{ url_for('static', filename='metro_rio.mp3') }}" type="audio/mpeg">
  </audio>

  <dialog id="configDialog">
    <form action="/inicializar_partida" method="POST">
      <label for="duracao_turno">Duração do turno:</label>
      <select name="duracao_turno" id="duracao_turno">
        <option value="60">1 minuto</option>
        <option value="120">2 minutos</option>
        <option value="180" selected>3 minutos</option>
        <option value="240">4 minutos</option>
        <option value="300">5 minutos</option>
      </select>
      
      <label for="qtd_humanos">Quantidade de jogadores humanos:</label>
      <select name="qtd_humanos" id="qtd_humanos">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
      </select>
      
      <label for="qtd_ai">Quantidade de jogadores artificiais:</label>
      <select name="qtd_ai" id="qtd_ai">
        <option value="0" selected>0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
      </select>

      <!-- <button type="submit" name="acao" value="iniciar">Iniciar</button> -->
    </form>
    <br/><button id="continueBtn" name="acao" value="iniciar">Continuar</button>
    <br/><button id="closeConfigDialogBtn" name="acao" value="cancelar">Cancelar</button>
  </dialog>

    <dialog id="playerDialog">
      <form action="/inicializar_partida" method="POST">
        <label>Jogador 1</label>
        <!-- aqui vai entrar a seleção das cores
         no back já vou selecionar aleatoriamente os territorios iniciais dos jogadores -->
        <button type="submit" name="acao" value="iniciar">Iniciar</button>
      </form>
    <br/><button id="closePlayerConfig" name="acao" value="cancelar">Cancelar</button> 
    <!-- fix styles -->
    <!-- TODO adicionar botão de voltar -->
  </dialog>

  <script>
    const configDialog = document.getElementById('configDialog');
    const playerDialog = document.getElementById('playerDialog');
    const openBtn = document.getElementById('openDialog');
    const continueBtn = document.getElementById('continueBtn');
    const closeConfigDialogBtn = document.getElementById('closeConfigDialogBtn');
    const closePlayerConfigBtn = document.getElementById('closePlayerConfig');
    const audio = document.getElementById("audio");

    openBtn.addEventListener('click', () => {
      audio.play();
      configDialog.showModal();
    });

    closeConfigDialogBtn.addEventListener('click', () => {
      configDialog.close();
    });

    closePlayerConfigBtn.addEventListener('click', () => {
      playerDialog.close();
    });

    continueBtn.addEventListener('click', () => {
      validado = validate_num_players();
      if (!validado) {
        alert("O número total de jogadores deve ser entre 3 e 6.");
        return;
      }
      configDialog.close();
      playerDialog.showModal();
    });

    function validate_num_players() {
      const qtd_humanos = parseInt(document.getElementById('qtd_humanos').value);
      const qtd_ai = parseInt(document.getElementById('qtd_ai').value);
      const total_players = qtd_humanos + qtd_ai;
      return total_players >= 3 && total_players <= 6;
    }
  </script>
</body>
</html>